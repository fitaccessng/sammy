{% extends "admin/base_simple.html" %}

{% block title %}Add New Equipment - Construction Management System{% endblock %}

{% block header %}Add New Equipment{% endblock %}

{% block head %}
{{ super() }}
<!-- Ensure BoxIcons is loaded -->
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<style>
    /* Force BoxIcons to load properly */
    @import url('https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css');
    
    /* Professional Design System */
    :root {
        --primary-color: #3b82f6;
        --primary-light: #eff6ff;
        --primary-dark: #1e40af;
        --success-color: #10b981;
        --success-light: #ecfdf5;
        --warning-color: #f59e0b;
        --warning-light: #fffbeb;
        --danger-color: #ef4444;
        --danger-light: #fef2f2;
        --indigo-color: #6366f1;
        --indigo-light: #eef2ff;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
        --border-radius: 12px;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Modern Card Styling */
    .modern-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--gray-200);
        transition: var(--transition);
    }

    .modern-card:hover {
        box-shadow: var(--shadow-md);
    }

    /* Enhanced Professional Button System */
    .btn-modern {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.875rem;
        line-height: 1.25rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2px solid transparent;
        cursor: pointer;
        text-decoration: none;
        position: relative;
        overflow: hidden;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        user-select: none;
        white-space: nowrap;
        text-align: center;
        vertical-align: middle;
        min-height: 44px;
        letter-spacing: 0.025em;
        box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.1);
    }

    .btn-modern:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        z-index: 10;
    }

    .btn-modern:active {
        transform: translateY(1px) scale(0.98);
    }

    .btn-modern:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
    }

    /* Shimmer effect for premium feel */
    .btn-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.6s;
    }

    .btn-modern:hover::before {
        left: 100%;
    }

    /* Primary Button Variants */
    .btn-primary-modern {
        background: linear-gradient(135deg, #3b82f6 0%, #1e40af 50%, #1e3a8a 100%);
        color: white;
        border-color: #1e40af;
        box-shadow: 0 4px 12px 0 rgba(59, 130, 246, 0.3), 0 2px 4px 0 rgba(0, 0, 0, 0.1);
    }

    .btn-primary-modern:hover {
        background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 50%, #312e81 100%);
        border-color: #1e3a8a;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px 0 rgba(59, 130, 246, 0.4), 0 4px 8px 0 rgba(0, 0, 0, 0.15);
    }

    /* Success Button Variants */
    .btn-success-modern {
        background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
        color: white;
        border-color: #059669;
        box-shadow: 0 4px 12px 0 rgba(16, 185, 129, 0.3), 0 2px 4px 0 rgba(0, 0, 0, 0.1);
    }

    .btn-success-modern:hover {
        background: linear-gradient(135deg, #059669 0%, #047857 50%, #065f46 100%);
        border-color: #047857;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px 0 rgba(16, 185, 129, 0.4), 0 4px 8px 0 rgba(0, 0, 0, 0.15);
    }

    /* Secondary Button Variants */
    .btn-secondary-modern {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        color: #374151;
        border-color: #d1d5db;
        box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.05);
    }

    .btn-secondary-modern:hover {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-color: #9ca3af;
        color: #1f2937;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.1);
    }

    /* Button Size Variants */
    .btn-lg-modern {
        padding: 1rem 2rem;
        font-size: 1rem;
        min-height: 52px;
        border-radius: 16px;
    }

    /* Icon Button Variants */
    .btn-icon-modern {
        padding: 0.75rem;
        min-width: 44px;
        justify-content: center;
        border-radius: 12px;
    }

    /* Icon spacing within buttons */
    .btn-modern i {
        margin-right: 0.5rem;
        font-size: 1rem;
        line-height: 1;
        display: inline-block;
        vertical-align: middle;
    }

    .btn-modern i:only-child {
        margin: 0;
    }

    /* Ensure BoxIcons are displayed properly - Enhanced */
    .btn-modern i[class*="bx"]:before {
        font-family: boxicons !important;
        font-style: normal !important;
        font-weight: normal !important;
        display: inline-block !important;
        text-decoration: inherit !important;
        text-align: center !important;
        font-variant: normal !important;
        text-transform: none !important;
        line-height: 1 !important;
        -webkit-font-smoothing: antialiased !important;
        -moz-osx-font-smoothing: grayscale !important;
    }

    /* Specific BoxIcon classes - Fallback */
    .bx {
        font-family: boxicons !important;
        font-weight: 900 !important;
        font-style: normal !important;
    }

    /* Common BoxIcon codes as fallback */
    .bx-plus:before { content: "\ea13" !important; }
    .bx-arrow-back:before { content: "\e965" !important; }
    .bx-x:before { content: "\ea24" !important; }
    .bx-check:before { content: "\e9c6" !important; }
    .bx-info-circle:before { content: "\e9fc" !important; }
    .bx-map:before { content: "\ea04" !important; }
    .bx-money:before { content: "\ea06" !important; }
    .bx-wrench:before { content: "\ea22" !important; }
    .bx-show:before { content: "\ea15" !important; }
    .bx-calendar:before { content: "\e9c1" !important; }

    /* Form Styles */
    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 0.5rem;
    }

    .form-label.required::after {
        content: " *";
        color: var(--danger-color);
    }

    .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--gray-300);
        border-radius: 8px;
        font-size: 0.875rem;
        transition: var(--transition);
        background-color: white;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-input:invalid {
        border-color: var(--danger-color);
    }

    .form-textarea {
        min-height: 100px;
        resize: vertical;
    }

    .form-select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
    }

    /* Grid Layout */
    .form-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    @media (min-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    /* Section Headers */
    .section-header {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--gray-200);
    }

    /* Equipment Preview */
    .equipment-preview {
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        border: 1px solid #bfdbfe;
        border-radius: var(--border-radius);
        padding: 1.5rem;
        margin-top: 1rem;
    }

    /* Status Styling */
    .status-preview {
        display: inline-flex;
        align-items: center;
        padding: 0.375rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .status-active {
        background-color: var(--success-light);
        color: #065f46;
    }

    .status-maintenance {
        background-color: var(--warning-light);
        color: #92400e;
    }

    .status-retired {
        background-color: var(--danger-light);
        color: #991b1b;
    }

    /* Error styling */
    .form-error {
        color: var(--danger-color);
        font-size: 0.75rem;
        margin-top: 0.25rem;
    }

    /* Utility classes */
    .flex {
        display: flex;
    }

    .flex-1 {
        flex: 1;
    }

    .gap-2 {
        gap: 0.5rem;
    }

    .gap-4 {
        gap: 1rem;
    }

    .justify-between {
        justify-content: space-between;
    }

    .items-center {
        align-items: center;
    }

    .items-start {
        align-items: flex-start;
    }

    .w-full {
        width: 100%;
    }

    .text-2xl {
        font-size: 1.5rem;
        line-height: 2rem;
    }

    .font-bold {
        font-weight: 700;
    }

    .font-semibold {
        font-weight: 600;
    }

    .text-gray-800 {
        color: var(--gray-800);
    }

    .text-gray-600 {
        color: var(--gray-500);
    }

    .text-sm {
        font-size: 0.875rem;
    }

    .mb-2 {
        margin-bottom: 0.5rem;
    }

    .mb-3 {
        margin-bottom: 0.75rem;
    }

    .mb-6 {
        margin-bottom: 1.5rem;
    }

    .mb-8 {
        margin-bottom: 2rem;
    }

    .mt-2 {
        margin-top: 0.5rem;
    }

    .mt-4 {
        margin-top: 1rem;
    }

    .ml-2 {
        margin-left: 0.5rem;
    }

    .mr-2 {
        margin-right: 0.5rem;
    }

    .p-8 {
        padding: 2rem;
    }

    .p-4 {
        padding: 1rem;
    }

    .pt-6 {
        padding-top: 1.5rem;
    }

    .border-t {
        border-top: 1px solid var(--gray-200);
    }

    .border {
        border: 1px solid var(--gray-200);
    }

    .rounded-lg {
        border-radius: 0.5rem;
    }

    .bg-yellow-50 {
        background-color: #fffbeb;
    }

    .border-yellow-200 {
        border-color: #fde68a;
    }

    .text-yellow-600 {
        color: #d97706;
    }

    .text-yellow-800 {
        color: #92400e;
    }

    .text-yellow-700 {
        color: #b45309;
    }

    .font-medium {
        font-weight: 500;
    }

    .hidden {
        display: none;
    }

    .grid {
        display: grid;
    }

    .grid-cols-1 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
    }

    .grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    @media (min-width: 768px) {
        .md\:grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }

    /* Responsive Design */
    @media (max-width: 640px) {
        .flex-col {
            flex-direction: column;
        }
        
        .sm\:flex-row {
            flex-direction: row;
        }

        .sm\:flex-none {
            flex: none;
        }
    }
</style>

<!-- Page Header -->
<div class="flex justify-between items-start mb-6">
    <div>
        <h1 class="text-2xl font-bold text-gray-800 mb-2">Add New Equipment</h1>
        <p class="text-gray-600">Register new equipment for inventory management and tracking</p>
    </div>
    <a href="{{ url_for('admin.equipment') }}" class="btn-modern btn-secondary-modern">
        <i class='bx bx-arrow-back'></i>
        Back to Equipment
    </a>
</div>

<!-- Add Equipment Form -->
<div class="modern-card p-8">
    <form class="" method="POST" action="{{ url_for('admin.add_equipment') }}" id="addEquipmentForm">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
        <!-- Basic Information Section -->
        <div class="mb-8">
            <h2 class="section-header">
                <i class='bx bx-info-circle mr-2'></i>
                Basic Information
            </h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="name" class="form-label required">Equipment Name</label>
                    <input type="text" 
                           id="name" 
                           name="name" 
                           class="form-input" 
                           placeholder="Enter equipment name"
                           required
                           maxlength="100">
                    <div class="form-error" id="nameError"></div>
                </div>

                <div class="form-group">
                    <label for="status" class="form-label">Status</label>
                    <select id="status" name="status" class="form-input form-select" onchange="updateStatusPreview()">
                        <option value="Active">Active</option>
                        <option value="Maintenance">Under Maintenance</option>
                        <option value="Retired">Retired</option>
                    </select>
                    <div id="statusPreview" class="mt-2">
                        <span class="status-preview status-active">Active</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="description" class="form-label">Description/Remarks</label>
                <textarea id="description" 
                          name="description" 
                          class="form-input form-textarea" 
                          placeholder="Enter equipment description, specifications, and notes"
                          rows="4"></textarea>
            </div>
        </div>

        <!-- Equipment Details Section -->
        <div class="mb-8">
            <h2 class="section-header">
                <i class='bx bx-wrench mr-2'></i>
                Equipment Details
            </h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="machine_hours" class="form-label">Machine Hours</label>
                    <input type="number" 
                           id="machine_hours" 
                           name="machine_hours" 
                           class="form-input" 
                           placeholder="0"
                           min="0"
                           step="0.1">
                </div>

                <div class="form-group">
                    <label for="diesel_consumption" class="form-label">Diesel Consumption (Liters)</label>
                    <input type="number" 
                           id="diesel_consumption" 
                           name="diesel_consumption" 
                           class="form-input" 
                           placeholder="0"
                           min="0"
                           step="0.1">
                </div>
            </div>

            <div class="form-group">
                <label for="last_maintenance_date" class="form-label">Maintenance Due Date</label>
                <input type="date" 
                       id="last_maintenance_date" 
                       name="last_maintenance_date" 
                       class="form-input">
            </div>
        </div>

        <!-- Equipment Preview -->
        <div class="equipment-preview">
            <h3 class="font-semibold text-gray-800 mb-3">
                <i class='bx bx-show mr-2'></i>
                Equipment Preview
            </h3>
            <div id="equipmentPreview" class="text-sm text-gray-600">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><strong>Name:</strong> <span id="previewName">-</span></div>
                    <div><strong>Status:</strong> <span id="previewStatus">Active</span></div>
                    <div><strong>Machine Hours:</strong> <span id="previewMachineHours">0</span></div>
                    <div><strong>Diesel Consumption:</strong> <span id="previewDieselConsumption">0 L</span></div>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
            <button type="submit" class="btn-modern btn-lg-modern btn-primary-modern flex-1 sm:flex-none">
                <i class='bx bx-plus'></i>
                Add Equipment
            </button>
            <a href="{{ url_for('admin.equipment') }}" class="btn-modern btn-lg-modern btn-secondary-modern flex-1 sm:flex-none">
                <i class='bx bx-x'></i>
                Cancel
            </a>
        </div>
    </form>
</div>

<script>
// Ensure BoxIcons are loaded properly
document.addEventListener('DOMContentLoaded', function() {
    // Check if BoxIcons font is loaded
    function checkBoxIconsLoaded() {
        // Create a test element to check if the font is loaded
        const testElement = document.createElement('i');
        testElement.className = 'bx bx-test';
        testElement.style.position = 'absolute';
        testElement.style.left = '-9999px';
        testElement.style.fontSize = '16px';
        document.body.appendChild(testElement);
        
        const computedStyle = window.getComputedStyle(testElement);
        const fontFamily = computedStyle.getPropertyValue('font-family');
        
        document.body.removeChild(testElement);
        
        // If BoxIcons isn't loaded, try to reload it
        if (!fontFamily.includes('boxicons')) {
            console.warn('BoxIcons not detected, attempting to reload...');
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css';
            document.head.appendChild(link);
        }
    }
    
    // Check icons after a short delay
    setTimeout(checkBoxIconsLoaded, 100);
    
    // Form validation and preview updates
    const form = document.getElementById('addEquipmentForm');
    const nameInput = document.getElementById('name');
    const statusSelect = document.getElementById('status');
    const machineHoursInput = document.getElementById('machine_hours');
    const dieselConsumptionInput = document.getElementById('diesel_consumption');

    // Real-time preview updates
    function updatePreview() {
        document.getElementById('previewName').textContent = nameInput.value || '-';
        document.getElementById('previewMachineHours').textContent = machineHoursInput.value || '0';
        document.getElementById('previewDieselConsumption').textContent = (dieselConsumptionInput.value || '0') + ' L';
        
        const statusElement = document.getElementById('previewStatus');
        statusElement.textContent = statusSelect.value;
        statusElement.className = `status-preview status-${statusSelect.value.toLowerCase()}`;
    }

    // Add event listeners for real-time updates
    nameInput.addEventListener('input', updatePreview);
    statusSelect.addEventListener('change', updatePreview);
    machineHoursInput.addEventListener('input', updatePreview);
    dieselConsumptionInput.addEventListener('input', updatePreview);

    // Name validation
    nameInput.addEventListener('input', function() {
        const nameError = document.getElementById('nameError');
        if (this.value.trim().length < 3) {
            nameError.textContent = 'Equipment name must be at least 3 characters long';
            nameError.className = 'form-error';
            this.style.borderColor = 'var(--danger-color)';
        } else {
            nameError.textContent = '';
            this.style.borderColor = 'var(--gray-300)';
        }
    });

    // Form submission validation
    form.addEventListener('submit', function(e) {
        if (nameInput.value.trim().length < 3) {
            e.preventDefault();
            nameInput.focus();
            return false;
        }

        // Show loading state
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="bx bx-loader bx-spin"></i> Adding Equipment...';
        submitBtn.disabled = true;

        // Re-enable button after 5 seconds in case of error
        setTimeout(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }, 5000);
    });

    // Auto-focus on first input
    nameInput.focus();

    // Initialize preview
    updatePreview();
});

function updateStatusPreview() {
    const status = document.getElementById('status').value;
    const preview = document.getElementById('statusPreview');
    const statusClass = `status-${status.toLowerCase()}`;
    
    preview.innerHTML = `<span class="status-preview ${statusClass}">${status}</span>`;
    
    // Update main preview
    const statusElement = document.getElementById('previewStatus');
    statusElement.textContent = status;
    statusElement.className = `status-preview ${statusClass}`;
}
</script>

{% endblock %}