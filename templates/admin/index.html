{% extends "admin/base_simple.html" %}

{% block title %}Admin Dashboard - Construction Management System{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="flex justify-between flex-wrap items-center pt-6 pb-4 mb-6 border-b border-gray-200">
    <h1 class="text-3xl font-bold text-gray-800">Administration Dashboard</h1>
    <div class="flex gap-2 mt-2 sm:mt-0">
        <button type="button" class="px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
            Export
        </button>
        <button type="button" class="px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
            <i class="fas fa-download"></i>
            Generate Report
        </button>
    </div>
</div>

<!-- Key Metrics Cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6 mb-6">
    <!-- Active Projects Card -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <div class="bg-blue-50 p-4 rounded-xl">
                    <i class="fas fa-project-diagram text-blue-600 text-2xl"></i>
                </div>
            </div>
            <div class="ml-4 flex-1">
                <p class="text-sm text-gray-500 mb-1">Active Projects</p>
                <h3 class="text-3xl font-bold text-gray-800">{{ summary.active_projects or 0 }}</h3>
                <div class="text-sm text-green-600 mt-1">
                    <i class="fas fa-check-circle mr-1"></i>
                    <a href="{{ url_for('project.project_home') }}" class="hover:underline">View all projects</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Total Staff Card -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <div class="bg-green-50 p-4 rounded-xl">
                    <i class="fas fa-users text-green-600 text-2xl"></i>
                </div>
            </div>
            <div class="ml-4 flex-1">
                <p class="text-sm text-gray-500 mb-1">Total Staff</p>
                <h3 class="text-3xl font-bold text-gray-800">{{ summary.total_staff or 0 }}</h3>
                <div class="text-sm text-blue-600 mt-1">
                    <i class="fas fa-info-circle mr-1"></i>
                    <a href="{{ url_for('hr.staff_list') }}" class="hover:underline">Manage staff</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Alerts Card -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <div class="bg-yellow-50 p-4 rounded-xl">
                    <i class="fas fa-bell text-yellow-600 text-2xl"></i>
                </div>
            </div>
            <div class="ml-4 flex-1">
                <p class="text-sm text-gray-500 mb-1">Active Alerts</p>
                <h3 class="text-3xl font-bold text-gray-800">{{ summary.total_alerts or 0 }}</h3>
                <div class="text-sm text-yellow-600 mt-1">
                    <i class="fas fa-exclamation-triangle mr-1"></i>
                    <a href="#" class="hover:underline">View alerts</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Total Projects Card -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <div class="bg-red-50 p-4 rounded-xl">
                    <i class="fas fa-folder-open text-red-600 text-2xl"></i>
                </div>
            </div>
            <div class="ml-4 flex-1">
                <p class="text-sm text-gray-500 mb-1">Total Projects</p>
                <h3 class="text-3xl font-bold text-gray-800">{{ summary.total_projects or 0 }}</h3>
                <div class="text-sm text-red-600 mt-1">
                    <i class="fas fa-archive mr-1"></i>
                    <a href="{{ url_for('project.project_home') }}" class="hover:underline">All projects</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Management Sections -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
    <!-- Quick Actions -->
    <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 h-full">
            <div class="p-6 border-b border-gray-100">
                <h5 class="text-xl font-semibold text-gray-800 mb-1">Administrative Actions</h5>
                <p class="text-sm text-gray-500">Quick access to key management functions</p>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- User Management -->
                    <a href="{{ url_for('admin.comprehensive_user_management') }}" class="group">
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-purple-300 hover:bg-purple-50 hover:shadow-md transition-all duration-200">
                            <div class="bg-purple-100 p-3 rounded-full mr-3 group-hover:bg-purple-200">
                                <i class="fas fa-users-cog text-purple-600 text-lg"></i>
                            </div>
                            <div>
                                <h6 class="font-semibold text-gray-800 mb-0">User Management</h6>
                                <small class="text-gray-500">All users, roles & projects</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Manage Roles -->
                    <a href="{{ url_for('admin.roles_view') }}" class="group">
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 hover:shadow-md transition-all duration-200">
                            <div class="bg-blue-100 p-3 rounded-full mr-3 group-hover:bg-blue-200">
                                <i class="fas fa-users text-blue-600 text-lg"></i>
                            </div>
                            <div>
                                <h6 class="font-semibold text-gray-800 mb-0">Manage Roles</h6>
                                <small class="text-gray-500">Define system roles</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Reporting Lines -->
                    <a href="{{ url_for('admin.reporting_lines_view') }}" class="group">
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-green-300 hover:bg-green-50 hover:shadow-md transition-all duration-200">
                            <div class="bg-green-100 p-3 rounded-full mr-3 group-hover:bg-green-200">
                                <i class="fas fa-sitemap text-green-600 text-lg"></i>
                            </div>
                            <div>
                                <h6 class="font-semibold text-gray-800 mb-0">Reporting Lines</h6>
                                <small class="text-gray-500">Org structure</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Approval Flow -->
                    <a href="{{ url_for('admin.approval_hierarchy_view') }}" class="group">
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-yellow-300 hover:bg-yellow-50 hover:shadow-md transition-all duration-200">
                            <div class="bg-yellow-100 p-3 rounded-full mr-3 group-hover:bg-yellow-200">
                                <i class="fas fa-layer-group text-yellow-600 text-lg"></i>
                            </div>
                            <div>
                                <h6 class="font-semibold text-gray-800 mb-0">Approval Flow</h6>
                                <small class="text-gray-500">Workflow setup</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Permissions -->
                    <a href="{{ url_for('admin.permissions_view') }}" class="group">
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-red-300 hover:bg-red-50 hover:shadow-md transition-all duration-200">
                            <div class="bg-red-100 p-3 rounded-full mr-3 group-hover:bg-red-200">
                                <i class="fas fa-key text-red-600 text-lg"></i>
                            </div>
                            <div>
                                <h6 class="font-semibold text-gray-800 mb-0">Permissions</h6>
                                <small class="text-gray-500">Access control</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Reports -->
                    <a href="{{ url_for('admin.oversight_reports_view') }}" class="group">
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-cyan-300 hover:bg-cyan-50 hover:shadow-md transition-all duration-200">
                            <div class="bg-cyan-100 p-3 rounded-full mr-3 group-hover:bg-cyan-200">
                                <i class="fas fa-chart-bar text-cyan-600 text-lg"></i>
                            </div>
                            <div>
                                <h6 class="font-semibold text-gray-800 mb-0">Reports</h6>
                                <small class="text-gray-500">System insights</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Procurement Management -->
                    <a href="{{ url_for('procurement.procurement_home') }}" class="group">
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 hover:shadow-md transition-all duration-200">
                            <div class="bg-indigo-100 p-3 rounded-full mr-3 group-hover:bg-indigo-200">
                                <i class="fas fa-shopping-cart text-indigo-600 text-lg"></i>
                            </div>
                            <div>
                                <h6 class="font-semibold text-gray-800 mb-0">Procurement</h6>
                                <small class="text-gray-500">Purchases & suppliers</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Cost Control Management -->
                    <a href="{{ url_for('cost_control.cost_control_home') }}" class="group">
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-orange-300 hover:bg-orange-50 hover:shadow-md transition-all duration-200">
                            <div class="bg-orange-100 p-3 rounded-full mr-3 group-hover:bg-orange-200">
                                <i class="fas fa-calculator text-orange-600 text-lg"></i>
                            </div>
                            <div>
                                <h6 class="font-semibold text-gray-800 mb-0">Cost Control</h6>
                                <small class="text-gray-500">Budget tracking</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Finance Management -->
                    <a href="{{ url_for('finance.finance_home') }}" class="group">
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-emerald-300 hover:bg-emerald-50 hover:shadow-md transition-all duration-200">
                            <div class="bg-emerald-100 p-3 rounded-full mr-3 group-hover:bg-emerald-200">
                                <i class="fas fa-money-bill-wave text-emerald-600 text-lg"></i>
                            </div>
                            <div>
                                <h6 class="font-semibold text-gray-800 mb-0">Finance</h6>
                                <small class="text-gray-500">Payroll & expenses</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Approvals Management -->
                    <a href="{{ url_for('admin.approvals') }}" class="group">
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-rose-300 hover:bg-rose-50 hover:shadow-md transition-all duration-200">
                            <div class="bg-rose-100 p-3 rounded-full mr-3 group-hover:bg-rose-200">
                                <i class="fas fa-clipboard-check text-rose-600 text-lg"></i>
                            </div>
                            <div>
                                <h6 class="font-semibold text-gray-800 mb-0">Approvals</h6>
                                <small class="text-gray-500">Pending approvals</small>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity Log -->
    <div class="lg:col-span-1">
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 h-full">
            <div class="p-6 border-b border-gray-100">
                <h5 class="text-xl font-semibold text-gray-800 mb-1">Recent Activity</h5>
                <p class="text-sm text-gray-500">System-wide activity log</p>
            </div>
            <div class="p-6">
                <div class="space-y-4 max-h-96 overflow-y-auto">
                    {% if recent_activities %}
                        {% for activity in recent_activities %}
                        <div class="flex items-start space-x-3 pb-4 border-b border-gray-100 last:border-0">
                            <div class="flex-shrink-0">
                                {% if 'milestone' in activity.action_type.lower() %}
                                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-flag text-blue-600 text-xs"></i>
                                    </div>
                                {% elif 'staff' in activity.action_type.lower() or 'assign' in activity.action_type.lower() %}
                                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user-plus text-green-600 text-xs"></i>
                                    </div>
                                {% elif 'document' in activity.action_type.lower() or 'upload' in activity.action_type.lower() %}
                                    <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-file text-purple-600 text-xs"></i>
                                    </div>
                                {% elif 'budget' in activity.action_type.lower() or 'cost' in activity.action_type.lower() %}
                                    <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-dollar-sign text-yellow-600 text-xs"></i>
                                    </div>
                                {% elif 'delete' in activity.action_type.lower() or 'remove' in activity.action_type.lower() %}
                                    <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-trash text-red-600 text-xs"></i>
                                    </div>
                                {% elif 'update' in activity.action_type.lower() or 'edit' in activity.action_type.lower() %}
                                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-edit text-orange-600 text-xs"></i>
                                    </div>
                                {% elif 'create' in activity.action_type.lower() or 'add' in activity.action_type.lower() %}
                                    <div class="w-8 h-8 bg-cyan-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-plus text-cyan-600 text-xs"></i>
                                    </div>
                                {% else %}
                                    <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-info text-gray-600 text-xs"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm text-gray-800 font-medium truncate">
                                    {{ activity.user_name or 'System' }}
                                </p>
                                <p class="text-xs text-gray-600 mt-1">
                                    {{ activity.description[:80] }}{% if activity.description|length > 80 %}...{% endif %}
                                </p>
                                <p class="text-xs text-gray-400 mt-1">
                                    <i class="far fa-clock mr-1"></i>
                                    {{ activity.created_at.strftime('%b %d, %I:%M %p') if activity.created_at else 'Just now' }}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-8">
                            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-history text-gray-400 text-2xl"></i>
                            </div>
                            <p class="text-sm text-gray-500">No recent activity</p>
                            <p class="text-xs text-gray-400 mt-1">Activity logs will appear here</p>
                        </div>
                    {% endif %}
                </div>
                
                {% if recent_activities %}
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <a href="{{ url_for('admin.activity_log') }}" class="text-sm text-blue-600 hover:text-blue-700 font-medium flex items-center justify-center">
                        View all activity
                        <i class="fas fa-arrow-right ml-2 text-xs"></i>
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity & Analytics -->

{% endblock %}


{% block styles %}
<style>
/* Tailwind custom animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-fade-in-up {
    animation: fadeInUp 0.6s ease-out forwards;
}

/* Stagger animation delays for cards */
.card-1 { animation-delay: 0.1s; }
.card-2 { animation-delay: 0.2s; }
.card-3 { animation-delay: 0.3s; }
.card-4 { animation-delay: 0.4s; }

/* Mobile responsive divider fix */
@media (max-width: 768px) {
    .divide-x > * {
        border-right: none !important;
        border-bottom: 1px solid #e5e7eb;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
    }
    
    .divide-x > *:last-child {
        border-bottom: none !important;
        margin-bottom: 0;
        padding-bottom: 0;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add fade-in animations to metric cards
    const metricCards = document.querySelectorAll('.bg-white.rounded-xl');
    metricCards.forEach((card, index) => {
        card.classList.add('animate-fade-in-up', `card-${index + 1}`);
        card.style.opacity = '0';
        setTimeout(() => {
            card.style.opacity = '1';
        }, index * 100);
    });
    
    // Refresh button functionality
    const refreshBtn = document.querySelector('button:has(.fa-sync)');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            const icon = this.querySelector('.fa-sync');
            icon.classList.add('animate-spin');
            
            // Simulate refresh
            setTimeout(() => {
                icon.classList.remove('animate-spin');
                location.reload();
            }, 1000);
        });
    }
    
    // Add hover scale effect to action cards
    const actionCards = document.querySelectorAll('a > div.border');
    actionCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
    });
});
</script>

<style>
/* Add spin animation for refresh icon */
@keyframes spin {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

.animate-spin {
    animation: spin 1s linear infinite;
}
</style>
{% endblock %}