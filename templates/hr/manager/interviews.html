{% extends "hr/base.html" %}

{% block title %}Interview Management{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Interview Management</h1>
        <button onclick="document.getElementById('scheduleModal').classList.remove('hidden')" 
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
            <i class="fas fa-plus mr-2"></i>Schedule Interview
        </button>
    </div>

    <div class="mb-6 flex gap-2">
        <a href="?status=scheduled" class="px-4 py-2 rounded-lg {% if request.args.get('status', 'scheduled') == 'scheduled' %}bg-blue-600 text-white{% else %}bg-gray-200{% endif %}">
            Scheduled
        </a>
        <a href="?status=completed" class="px-4 py-2 rounded-lg {% if request.args.get('status') == 'completed' %}bg-blue-600 text-white{% else %}bg-gray-200{% endif %}">
            Completed
        </a>
        <a href="?status=cancelled" class="px-4 py-2 rounded-lg {% if request.args.get('status') == 'cancelled' %}bg-blue-600 text-white{% else %}bg-gray-200{% endif %}">
            Cancelled
        </a>
        <a href="?status=all" class="px-4 py-2 rounded-lg {% if request.args.get('status') == 'all' %}bg-blue-600 text-white{% else %}bg-gray-200{% endif %}">
            All
        </a>
    </div>

    <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Candidate</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Position</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date & Time</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Round</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Interviewer</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for interview in interviews %}
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4">
                        <div class="text-sm font-medium text-gray-900">{{ interview.candidate_name }}</div>
                        <div class="text-sm text-gray-500">{{ interview.candidate_email }}</div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">
                        {{ interview.recruitment.job_title }}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">
                        {{ interview.scheduled_date.strftime('%b %d, %Y') }}<br>
                        <span class="text-gray-500">{{ interview.scheduled_time.strftime('%I:%M %p') }}</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">
                        Round {{ interview.interview_round }}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">
                        {{ interview.interviewer_names or 'TBD' }}
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full
                            {% if interview.status == 'scheduled' %}bg-blue-100 text-blue-800
                            {% elif interview.status == 'completed' %}bg-green-100 text-green-800
                            {% elif interview.status == 'cancelled' %}bg-red-100 text-red-800
                            {% endif %}">
                            {{ interview.status }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {% if not interviews %}
        <div class="text-center py-12">
            <i class="fas fa-handshake text-gray-400 text-5xl mb-4"></i>
            <p class="text-gray-500">No interviews found</p>
        </div>
        {% endif %}
    </div>
</div>

<div id="scheduleModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold">Schedule Interview</h3>
            <button onclick="document.getElementById('scheduleModal').classList.add('hidden')" 
                    class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>

        <form method="POST" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Job Position *</label>
                <select name="recruitment_id" required class="w-full px-3 py-2 border rounded-lg">
                    <option value="">Select position</option>
                    {% for position in open_positions %}
                    <option value="{{ position.id }}">{{ position.job_title }} - {{ position.department }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Candidate Name *</label>
                    <input type="text" name="candidate_name" required class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Candidate Email *</label>
                    <input type="email" name="candidate_email" required class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Candidate Phone</label>
                    <input type="tel" name="candidate_phone" class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Interview Type *</label>
                    <select name="interview_type" required class="w-full px-3 py-2 border rounded-lg">
                        <option value="phone">Phone</option>
                        <option value="video">Video</option>
                        <option value="in-person">In-Person</option>
                        <option value="panel">Panel</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Interview Round</label>
                    <input type="number" name="interview_round" value="1" min="1" class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Duration (minutes)</label>
                    <input type="number" name="duration_minutes" value="60" class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date *</label>
                    <input type="date" name="scheduled_date" required class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Time *</label>
                    <input type="time" name="scheduled_time" required class="w-full px-3 py-2 border rounded-lg">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                <input type="text" name="location" class="w-full px-3 py-2 border rounded-lg">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Interviewers</label>
                <input type="text" name="interviewer_names" class="w-full px-3 py-2 border rounded-lg" 
                       placeholder="e.g., John Doe, Jane Smith">
            </div>
            <div class="flex justify-end gap-2 pt-4">
                <button type="button" onclick="document.getElementById('scheduleModal').classList.add('hidden')"
                        class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Schedule</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
